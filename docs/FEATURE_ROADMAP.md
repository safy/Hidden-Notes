# 🗺️ Feature Roadmap - Новый функционал

> Детальный план реализации запрошенных функций

**Создано**: 2025-10-21  
**Статус**: Planning

---

## 📋 Запрошенные функции

1. ✅ Добавление/удаление строк и столбцов в таблицах
2. ✅ Органы управления у таблицы
3. ✅ Добавление папок
4. ✅ Перенос заметок в папки
5. ✅ Добавление в архив
6. ✅ Смена цвета у папок

---

## 🎯 Разбивка на этапы

### Этап 1: Улучшенные таблицы (Приоритет: СРЕДНИЙ)

**Задачи**: 1, 2  
**Время**: 1-2 дня  
**Сложность**: Средняя  
**Зависимости**: Phase 2 (уже выполнена)

#### Задача 1.1: Контекстное меню для таблиц

**Описание**: Добавить ПКМ меню для управления таблицами

**Функционал**:
- Добавить строку выше
- Добавить строку ниже
- Удалить строку
- Добавить столбец слева
- Добавить столбец справа
- Удалить столбец
- Удалить таблицу

**Файлы**:
- `src/components/TiptapEditor/TableContextMenu.tsx` (новый)
- `src/components/TiptapEditor/TiptapEditor.tsx` (интеграция)

**Технические детали**:
```typescript
// Tiptap уже имеет встроенные команды для таблиц
editor.chain().focus().addRowBefore().run()
editor.chain().focus().addRowAfter().run()
editor.chain().focus().deleteRow().run()
editor.chain().focus().addColumnBefore().run()
editor.chain().focus().addColumnAfter().run()
editor.chain().focus().deleteColumn().run()
editor.chain().focus().deleteTable().run()
```

**Критерии приемки**:
- [ ] ПКМ на ячейке таблицы показывает меню
- [ ] Все команды работают корректно
- [ ] Меню закрывается после действия
- [ ] Undo/Redo работает для всех операций

---

#### Задача 1.2: Toolbar для активной таблицы

**Описание**: Bubble menu с кнопками управления при выборе ячейки таблицы

**Функционал**:
- Кнопки: [+ Строка ▲] [+ Строка ▼] [- Строка]
- Кнопки: [+ Столбец ◀] [+ Столбец ▶] [- Столбец]
- Кнопка: [🗑️ Удалить таблицу]
- Показывается автоматически при клике в ячейку

**Файлы**:
- `src/components/TiptapEditor/TableBubbleMenu.tsx` (новый)

**UI Mock**:
```
┌─────────────────────────────────────────┐
│ [+▲] [+▼] [-Row] │ [+◀] [+▶] [-Col] [🗑️] │
└─────────────────────────────────────────┘
```

**Критерии приемки**:
- [ ] Меню появляется при клике в ячейку
- [ ] Меню исчезает при клике вне таблицы
- [ ] Все кнопки функциональны
- [ ] Tooltips с описанием действий

---

### Этап 2: Система папок (Приоритет: ВЫСОКИЙ)

**Задачи**: 3, 4, 6  
**Время**: 3-4 дня  
**Сложность**: Высокая  
**Зависимости**: Phase 4 (уже выполнена)

#### Задача 2.1: Модель данных для папок

**Описание**: Расширить схему данных для поддержки папок

**Структура**:
```typescript
interface Folder {
  id: string;
  name: string;
  color: string;          // hex color для визуализации
  icon?: string;          // emoji или lucide icon name
  parentId: string | null; // для вложенных папок (v2.0)
  createdAt: number;
  updatedAt: number;
  order: number;          // для сортировки
}

interface Note {
  id: string;
  title: string;
  content: string;
  folderId: string | null; // ссылка на папку (null = без папки)
  createdAt: number;
  updatedAt: number;
  tags?: string[];
  isPinned?: boolean;
  isArchived?: boolean;    // для архива
}

interface StorageSchema {
  notes: Note[];
  folders: Folder[];       // NEW
  settings: Settings;
  currentNoteId: string | null;
  currentFolderId: string | null; // NEW - текущая открытая папка
}
```

**Миграция данных**:
```typescript
// Для существующих пользователей
async function migrateToFolders(oldSchema: OldSchema): Promise<NewSchema> {
  return {
    ...oldSchema,
    folders: [],
    currentFolderId: null,
  };
}
```

**Файлы**:
- `src/types/note.ts` (обновить)
- `src/types/folder.ts` (новый)
- `src/lib/storage.ts` (добавить CRUD для папок)

**Критерии приемки**:
- [ ] Interface Folder определен
- [ ] Note.folderId добавлен
- [ ] Миграция работает для старых данных
- [ ] CRUD операции для папок реализованы

---

#### Задача 2.2: UI компонент для папок

**Описание**: Визуальное представление папок в Sidebar

**Компоненты**:
- `src/components/Sidebar/FolderList.tsx` (новый)
- `src/components/Sidebar/FolderItem.tsx` (новый)
- `src/components/Sidebar/CreateFolderDialog.tsx` (новый)

**UI Mock**:
```
┌─────────────────────────┐
│ 📁 Работа (5) 🔵        │ ← Папка с цветом
│   📝 Встреча...         │
│   📝 Задачи...          │
│                         │
│ 📁 Личное (12) 🟢       │
│   📝 Идеи...            │
│   📝 Список...          │
│                         │
│ 📝 Без папки (3)        │ ← Заметки вне папок
│   📝 Быстрая...         │
└─────────────────────────┘
```

**Функционал**:
- Collapsible папки (раскрыть/свернуть)
- Показывать количество заметок в папке
- Drag & drop заметок между папками
- Цветовой индикатор папки
- Иконка папки (emoji или icon)

**Критерии приемки**:
- [ ] Папки отображаются в sidebar
- [ ] Можно раскрыть/свернуть папку
- [ ] Заметки группируются по папкам
- [ ] Drag & drop работает

---

#### Задача 2.3: Создание и редактирование папок

**Описание**: Dialog для создания и настройки папок

**Функционал**:
- Создать новую папку (кнопка [📁+])
- Редактировать название папки (inline или dialog)
- Выбрать цвет папки (color picker)
- Выбрать иконку (emoji picker)
- Удалить папку (с подтверждением)

**UI Dialog**:
```
┌──────────────────────────────────┐
│ Новая папка                   [×]│
├──────────────────────────────────┤
│ Название:                        │
│ ┌──────────────────────────────┐ │
│ │ Работа                       │ │
│ └──────────────────────────────┘ │
│                                  │
│ Цвет:                            │
│ ⬤ ⬤ ⬤ ⬤ ⬤ ⬤ ⬤ ⬤              │
│                                  │
│ Иконка (опционально):            │
│ 💼 📊 💻 📱 🎯 📚 🏠 🎨        │
│                                  │
│        [Отмена]  [Создать]       │
└──────────────────────────────────┘
```

**Цвета по умолчанию**:
```typescript
const FOLDER_COLORS = [
  '#3b82f6', // blue
  '#10b981', // green
  '#f59e0b', // amber
  '#ef4444', // red
  '#8b5cf6', // purple
  '#ec4899', // pink
  '#06b6d4', // cyan
  '#84cc16', // lime
];
```

**Файлы**:
- `src/components/Sidebar/CreateFolderDialog.tsx`
- `src/components/ColorPicker/FolderColorPicker.tsx`
- `src/components/EmojiPicker/EmojiPicker.tsx` (опционально)

**Критерии приемки**:
- [ ] Dialog открывается по кнопке
- [ ] Можно ввести название
- [ ] Можно выбрать цвет
- [ ] Можно выбрать иконку
- [ ] Папка создается корректно

---

#### Задача 2.4: Перемещение заметок в папки

**Описание**: Возможность организовать заметки по папкам

**Методы перемещения**:

1. **Drag & Drop**:
   - Перетащить заметку на папку в sidebar
   - Визуальный feedback при наведении

2. **Контекстное меню**:
   - ПКМ на заметке → "Переместить в папку..."
   - Выбор папки из списка

3. **Dialog перемещения**:
   - Кнопка в NoteView header [📁 Папка]
   - Dropdown с выбором папки

**Файлы**:
- `src/hooks/useFolders.ts` (новый)
- `src/components/Sidebar/Sidebar.tsx` (обновить)
- `src/components/NoteView/MoveFolderButton.tsx` (новый)

**Критерии приемки**:
- [ ] Drag & drop заметок в папки работает
- [ ] Контекстное меню позволяет выбрать папку
- [ ] Заметка перемещается в выбранную папку
- [ ] UI обновляется мгновенно

---

#### Задача 2.5: Цвета папок

**Описание**: Персонализация папок цветами

**Функционал**:
- Выбор цвета при создании папки
- Изменение цвета существующей папки
- Цветовой индикатор в sidebar
- Цветовая группировка (все заметки папки имеют accent цвет)

**UI**:
```
📁 Работа     🔵  (синяя полоска слева)
📁 Личное     🟢  (зеленая полоска)
📁 Проекты    🟣  (фиолетовая)
```

**CSS**:
```css
.folder-item {
  border-left: 3px solid var(--folder-color);
}

.note-in-folder {
  background: var(--folder-color-light);
}
```

**Критерии приемки**:
- [ ] Цвет папки отображается в sidebar
- [ ] Можно изменить цвет папки
- [ ] Заметки имеют визуальную связь с цветом папки
- [ ] 8 предустановленных цветов

---

### Этап 3: Архивирование (Приоритет: СРЕДНИЙ)

**Задача**: 5  
**Время**: 1 день  
**Сложность**: Низкая  
**Зависимости**: Задача 2.1 (модель данных)

#### Задача 3.1: Архив заметок

**Описание**: Возможность убрать заметки из основного списка без удаления

**Функционал**:
- Кнопка "В архив" для заметки
- Фильтр "Показать архив" в sidebar
- Восстановить из архива
- Архивные заметки не показываются в основном списке
- Архивные заметки не учитываются в счетчике папки

**UI**:
```
Sidebar Header:
┌─────────────────────────────┐
│ [+] [📁] [🔍] [📊] [📦]     │
│                    ↑ Архив  │
└─────────────────────────────┘

При клике на [📦]:
┌─────────────────────────────┐
│ 📦 Архив (23)               │
│ ┌─────────────────────────┐ │
│ │ 📝 Старая заметка       │ │
│ │ 📝 Проект 2024          │ │
│ │ [Восстановить] [Удалить]│ │
│ └─────────────────────────┘ │
└─────────────────────────────┘
```

**Модель данных**:
```typescript
interface Note {
  // ... existing fields
  isArchived?: boolean;      // NEW
  archivedAt?: number;       // NEW - timestamp архивирования
}
```

**Файлы**:
- `src/types/note.ts` (добавить isArchived)
- `src/components/Sidebar/ArchiveView.tsx` (новый)
- `src/hooks/useNotes.ts` (добавить archiveNote, unarchiveNote)

**Критерии приемки**:
- [ ] Заметку можно отправить в архив
- [ ] Архивные заметки не показываются в основном списке
- [ ] Можно просмотреть все архивные заметки
- [ ] Можно восстановить из архива
- [ ] Можно удалить из архива навсегда

---

### Этап 4: Интеграция и полировка (Приоритет: ВЫСОКИЙ)

**Время**: 2 дня  
**Сложность**: Средняя  
**Зависимости**: Все предыдущие этапы

#### Задача 4.1: Drag & Drop для папок и заметок

**Описание**: Реорганизация с помощью перетаскивания

**Функционал**:
- Drag заметки → Drop на папку = переместить в папку
- Drag заметки → Drop между заметками = изменить порядок
- Drag папки → Drop между папками = изменить порядок папок

**Библиотека**: `@dnd-kit` (уже установлена!)

**Критерии приемки**:
- [ ] Заметки перетаскиваются в папки
- [ ] Порядок заметок изменяется
- [ ] Порядок папок изменяется
- [ ] Визуальный feedback при перетаскивании

---

#### Задача 4.2: Поиск с учетом папок

**Описание**: Расширить поиск для фильтрации по папкам

**Функционал**:
- Поиск по всем заметкам (текущее поведение)
- Фильтр "Только в текущей папке"
- Показывать папку в результатах поиска
- Highlight совпадений в названии папки

**UI**:
```
┌──────────────────────────┐
│ 🔍 Поиск...              │
│ [📁 Все папки ▼]         │ ← Dropdown
├──────────────────────────┤
│ 📁 Работа > 📝 Встреча   │ ← Breadcrumb
│ 📁 Личное > 📝 Идеи      │
└──────────────────────────┘
```

**Критерии приемки**:
- [ ] Поиск работает по всем папкам
- [ ] Можно фильтровать по конкретной папке
- [ ] Результаты показывают путь к заметке
- [ ] Performance < 50ms для 1000 заметок

---

## 📅 Временная шкала

```
День 1-2: Этап 1 - Улучшенные таблицы
  ├─ День 1: Контекстное меню для таблиц
  └─ День 2: Toolbar для таблиц

День 3-6: Этап 2 - Система папок
  ├─ День 3: Модель данных + CRUD
  ├─ День 4: UI компоненты папок
  ├─ День 5: Создание/редактирование папок
  └─ День 6: Перемещение заметок, цвета

День 7: Этап 3 - Архивирование
  └─ День 7: Архив UI + логика

День 8-9: Этап 4 - Интеграция
  ├─ День 8: Drag & Drop
  └─ День 9: Поиск с папками

ИТОГО: 9 дней разработки
```

---

## 🎯 Приоритизация

### Must Have (v1.1.0) - для следующего релиза

1. **Этап 2: Система папок** ⭐ ВЫСОКИЙ
   - Критично для организации заметок
   - Пользователи часто просят эту функцию
   - Конкурентное преимущество

2. **Этап 3: Архивирование** ⭐ СРЕДНИЙ
   - Полезно для управления старыми заметками
   - Не блокирующая функция
   - Можно отложить на v1.2

### Nice to Have (v1.2.0) - можно отложить

3. **Этап 1: Улучшенные таблицы** ⭐ СРЕДНИЙ
   - Tiptap уже имеет базовые возможности
   - Добавит удобства но не критично
   - Можно реализовать позже

4. **Этап 4: Drag & Drop** ⭐ НИЗКИЙ
   - UX улучшение
   - Есть альтернативы (контекстное меню)
   - v1.2.0 или v2.0.0

---

## 📊 Оценка сложности

| Этап | Задачи | Время | Сложность | Приоритет | Версия |
|------|--------|-------|-----------|-----------|--------|
| Этап 1: Таблицы | 2 | 2 дня | 🟡 Средняя | Средний | v1.2.0 |
| **Этап 2: Папки** | **4** | **4 дня** | **🔴 Высокая** | **Высокий** | **v1.1.0** |
| Этап 3: Архив | 1 | 1 день | 🟢 Низкая | Средний | v1.1.0 |
| Этап 4: Интеграция | 2 | 2 дня | 🟡 Средняя | Низкий | v1.2.0 |
| **ИТОГО** | **9** | **9 дней** | - | - | - |

---

## 🚀 Рекомендуемый порядок реализации

### Вариант A: Быстрый релиз v1.0.0 → потом папки

```
1. Завершить Phase 5 (Testing & Polish)      [2 дня]
2. Завершить Phase 6 (Release)               [2 дня]
3. 🎉 Релиз v1.0.0
4. Реализовать Этап 2 (Папки)                [4 дня]
5. Реализовать Этап 3 (Архив)                [1 день]
6. 🎉 Релиз v1.1.0

Время до v1.0.0: ~4 дня
Время до v1.1.0 (с папками): ~9 дней
```

### Вариант B: v1.0.0 сразу с папками (рекомендуется!)

```
1. Реализовать Этап 2 (Папки)                [4 дня]
2. Реализовать Этап 3 (Архив)                [1 день]
3. Завершить Phase 5 (Testing)               [2 дня]
4. Завершить Phase 6 (Release)               [2 дня]
5. 🎉 Релиз v1.0.0 с папками!

Время до v1.0.0: ~9 дней
Преимущества: Более полноценный первый релиз
```

### Вариант C: Минимум сейчас, остальное потом

```
1. Только Этап 3 (Архив)                     [1 день]
2. Phase 5 (Testing)                         [2 дня]
3. Phase 6 (Release)                         [2 дня]
4. 🎉 Релиз v1.0.0
5. Этап 2 (Папки) в v1.1.0                   [4 дня]
6. Этап 1 (Таблицы) в v1.2.0                 [2 дня]

Время до v1.0.0: ~5 дней
Самый быстрый путь к релизу
```

---

## 💡 Мои рекомендации

### Рекомендую: Вариант B (v1.0.0 с папками)

**Почему**:
1. ✅ Папки - критическая функция для приложения заметок
2. ✅ Конкуренты уже имеют папки (ожидание пользователей)
3. ✅ Лучше выпустить позже, но с полным функционалом
4. ✅ Избежим миграции данных в v1.1.0
5. ✅ Первое впечатление важно

**Порядок реализации**:
```
Неделя 1:
  День 1: Задача 2.1 - Модель данных для папок
  День 2: Задача 2.2 - UI компоненты
  День 3: Задача 2.3 - Создание папок
  День 4: Задача 2.4 - Перемещение заметок
  День 5: Задача 2.5 - Цвета папок

Неделя 2:
  День 6: Задача 3.1 - Архивирование
  День 7-8: Phase 5 - Testing
  День 9-10: Phase 6 - Release preparation

🎉 Релиз v1.0.0 с папками через 10 дней!
```

---

## 🎨 UI/UX Концепция

### Sidebar с папками

```
┌─────────────────────────────────────┐
│ [+] [📁+] [🔍] [📊] [📦] [⚙️]      │ Header
├─────────────────────────────────────┤
│                                     │
│ 📌 Закрепленные (2)                 │
│   📝 Важная информация              │
│   📝 TODO на сегодня                │
│                                     │
│ 📁 💼 Работа (8) 🔵                 │ ← Раскрыта
│   📝 Встреча с клиентом             │
│   📝 Задачи на неделю               │
│   📝 Отчет Q3                       │
│   [Показать еще 5...]               │
│                                     │
│ 📁 🏠 Личное (12) 🟢 ▶             │ ← Свернута
│                                     │
│ 📁 📚 Обучение (5) 🟣 ▶             │
│                                     │
│ 📝 Без папки (3)                    │
│   📝 Быстрая заметка                │
│   📝 Черновик                       │
│                                     │
├─────────────────────────────────────┤
│ 📊 23 заметки • 3 папки             │ Footer
└─────────────────────────────────────┘
```

### Контекстное меню заметки

```
ПКМ на заметке:
┌──────────────────────┐
│ 📌 Закрепить         │
│ 📁 Переместить в...  │ → Submenu с папками
│ 🎨 Изменить цвет     │
│ 📦 В архив           │
│ ──────────────────── │
│ 🗑️ Удалить           │
└──────────────────────┘
```

### Контекстное меню папки

```
ПКМ на папке:
┌──────────────────────┐
│ ✏️ Переименовать     │
│ 🎨 Изменить цвет     │
│ 📝 Новая заметка     │
│ 📦 Архивировать все  │
│ ──────────────────── │
│ 🗑️ Удалить папку     │
└──────────────────────┘
```

---

## 📋 Детальный план Этапа 2 (Папки)

### День 1: Модель данных

**Утро (3-4 часа)**:
- [ ] Создать `src/types/folder.ts`
- [ ] Обновить `src/types/note.ts` (добавить folderId)
- [ ] Обновить `StorageSchema` (добавить folders)
- [ ] Создать функцию миграции для существующих данных

**День (2-3 часа)**:
- [ ] Расширить `src/lib/storage.ts`:
  - [ ] `getAllFolders()`
  - [ ] `getFolderById(id)`
  - [ ] `createFolder(folder)`
  - [ ] `updateFolder(id, updates)`
  - [ ] `deleteFolder(id)`
  - [ ] `moveNoteToFolder(noteId, folderId)`

**Вечер (1-2 часа)**:
- [ ] Unit тесты для folder CRUD операций
- [ ] Проверить миграцию на тестовых данных

---

### День 2: UI компоненты

**Утро (4 часа)**:
- [ ] Создать `src/components/Sidebar/FolderList.tsx`
- [ ] Создать `src/components/Sidebar/FolderItem.tsx`
- [ ] Интеграция в `Sidebar.tsx`

**День (3 часа)**:
- [ ] Создать `src/hooks/useFolders.ts`:
  - [ ] Загрузка папок из storage
  - [ ] addFolder, updateFolder, deleteFolder
  - [ ] moveNoteToFolder
  - [ ] Cross-tab sync

**Вечер (1 час)**:
- [ ] Стили для папок (collapsible, colors)
- [ ] Dark mode support

---

### День 3: Создание и редактирование

**Утро (3 часа)**:
- [ ] `src/components/Sidebar/CreateFolderDialog.tsx`
- [ ] shadcn/ui Dialog интеграция
- [ ] Форма с валидацией

**День (3 часа)**:
- [ ] `src/components/ColorPicker/FolderColorPicker.tsx`
- [ ] 8 предустановленных цветов
- [ ] Custom color picker (опционально)

**Вечер (2 часа)**:
- [ ] Редактирование папки (inline или dialog)
- [ ] Удаление папки с подтверждением
- [ ] Обработка заметок при удалении папки

---

### День 4: Перемещение заметок

**Утро (3 часа)**:
- [ ] Добавить dropdown "Папка" в NoteView header
- [ ] Список папок для выбора
- [ ] Обработчик перемещения

**День (3 часа)**:
- [ ] Контекстное меню для заметки
- [ ] Submenu с папками
- [ ] "Убрать из папки" опция

**Вечер (2 часа)**:
- [ ] Обновление sidebar после перемещения
- [ ] Toast уведомления
- [ ] Undo функциональность (опционально)

---

### День 5: Цвета и полировка

**Утро (2 часа)**:
- [ ] CSS стили для цветных папок
- [ ] Цветовые индикаторы в sidebar
- [ ] Accent colors для заметок в папке

**День (3 часа)**:
- [ ] Тестирование всего функционала папок
- [ ] Исправление багов
- [ ] Performance проверка

**Вечер (2 часа)**:
- [ ] Документация (`docs/FOLDERS_FEATURE.md`)
- [ ] Обновление changelog
- [ ] Обновление Tasktracker

---

## 🔧 Технические детали

### Storage структура с папками

```typescript
{
  "version": 1,
  "notes": [
    {
      "id": "note-1",
      "title": "Встреча",
      "content": "<p>...</p>",
      "folderId": "folder-work",  // ← Ссылка на папку
      "isArchived": false,
      "createdAt": 1697812800000,
      "updatedAt": 1697812900000
    }
  ],
  "folders": [
    {
      "id": "folder-work",
      "name": "Работа",
      "color": "#3b82f6",
      "icon": "💼",
      "order": 0,
      "createdAt": 1697812800000,
      "updatedAt": 1697812800000
    }
  ],
  "settings": { ... },
  "currentFolderId": "folder-work"
}
```

---

## 📝 Заметки

### Возможные проблемы

1. **Миграция данных** - нужно тестировать на реальных данных
2. **Performance** - сортировка заметок по папкам при большом количестве
3. **Вложенные папки** - отложить на v2.0 для простоты
4. **Удаление папки** - что делать с заметками? (переместить в "Без папки")

### Альтернативные подходы

**Теги вместо папок**:
- Pros: Заметка может быть в нескольких тегах
- Cons: Менее интуитивно, сложнее UI

**Вложенные папки (иерархия)**:
- Pros: Глубокая организация
- Cons: Сложность UI, может быть overkill для v1.0

**Решение**: Простые папки в v1.0, теги в v2.0, вложенность в v3.0

---

## ✅ Что делать дальше?

### Выберите вариант:

**A. Начать с Этапа 2 (Папки) прямо сейчас** ⭐ РЕКОМЕНДУЮ
   - Самая востребованная функция
   - Добавит большую ценность приложению

**B. Сначала Этап 1 (Таблицы)**
   - Проще реализовать
   - Полирует существующий функционал

**C. Сначала завершить Phase 5 (Testing)**
   - Стабилизировать текущий функционал
   - Релиз v1.0.0 без папок

**D. Реализовать всё последовательно**
   - Этап 1 → Этап 2 → Этап 3 → Этап 4
   - Полный функционал за 9 дней

---

**Какой вариант выбираем?** 🤔


