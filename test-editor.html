<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hidden Notes - Drag & Drop Test</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            padding: 2rem;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        h1 {
            font-size: 32px;
            margin-bottom: 0.5rem;
            color: #1a1a1a;
        }

        .subtitle {
            font-size: 14px;
            color: #666;
            margin-bottom: 2rem;
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .controls button {
            padding: 10px 16px;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: background 0.2s, transform 0.1s;
        }

        .controls button:hover {
            background: #2563eb;
        }

        .controls button:active {
            transform: scale(0.98);
        }

        .editor-wrapper {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin-bottom: 2rem;
            min-height: 400px;
            position: relative;
        }

        .editor {
            padding: 2rem;
            outline: none;
            min-height: 400px;
            line-height: 1.6;
        }

        .block {
            margin: 1rem 0;
            min-height: 1.5em;
            position: relative;
            padding: 4px 0;
            transition: background 0.1s;
            cursor: default;
        }

        .block[draggable="true"] {
            cursor: grab;
        }

        .block[draggable="true"]:active {
            cursor: grabbing;
        }

        .block::before {
            content: '‚ãÆ‚ãÆ';
            position: absolute;
            left: -30px;
            top: 50%;
            transform: translateY(-50%);
            width: 24px;
            text-align: center;
            cursor: grab;
            color: #666;
            font-size: 12px;
            opacity: 0;
            transition: opacity 0.2s;
            user-select: none;
        }

        .block:hover::before {
             opacity: 1;
             color: #1a1a1a;
             background-color: rgba(59, 130, 246, 0.15);
             border: 1px solid rgba(59, 130, 246, 0.3);
             border-radius: 3px;
         }

        .block.dragging {
            opacity: 0.5;
            background-color: rgba(59, 130, 246, 0.1);
            border: 2px solid #3b82f6; /* –î–æ–±–∞–≤–ª—è–µ–º –≤–∏–¥–∏–º—É—é –æ–±–≤–æ–¥–∫—É */
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.3); /* –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É */
        }

        .block.drag-over-top {
            border-top: 3px solid rgb(59, 130, 246);
            padding-top: 8px;
        }

        .block.drag-over-bottom {
            border-bottom: 3px solid rgb(59, 130, 246);
            padding-bottom: 8px;
        }

        .block.drag-over-bottom::after {
            content: '';
            display: block;
            height: 8px;
        }

        h2 {
            font-size: 24px;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
        }

        h3 {
            font-size: 20px;
            margin-top: 1.25rem;
            margin-bottom: 0.5rem;
        }

        .block.list {
            padding-left: 1.5rem;
        }

        .block.blockquote {
            border-left: 4px solid #ccc;
            padding-left: 1rem;
            color: #666;
            font-style: italic;
        }

        .status {
            background: #f0f0f0;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 1rem;
            font-size: 12px;
            font-family: 'Courier New', monospace;
            max-height: 200px;
            overflow-y: auto;
        }

        .status-item {
            margin: 5px 0;
            padding: 4px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .status-item:last-child {
            border-bottom: none;
        }

        .status-item.success { color: green; }
        .status-item.error { color: red; }
        .status-item.info { color: blue; }

        .instructions {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            border-radius: 6px;
            padding: 1rem;
            margin-bottom: 2rem;
        }

        .instructions h4 {
            margin: 0 0 0.5rem 0;
            color: #92400e;
        }

        .instructions ol {
            margin: 0;
            padding-left: 1.5rem;
        }

        .instructions li {
            margin: 4px 0;
        }

        strong {
            font-weight: 600;
        }

        code {
            background: #f0f0f0;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéâ Hidden Notes - Drag & Drop Test</h1>
        <p class="subtitle">–ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–π—Ç–µ –±–ª–æ–∫–∏ –∫–∞–∫ –≤ Notion (–Ω–∞–≤–µ–¥–∏—Ç–µ –º—ã—à—å –Ω–∞ —ç–ª–µ–º–µ–Ω—Ç)</p>

            <div class="instructions">
            <h4>üìã –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?</h4>
            <ol>
                <li>–ù–∞–≤–µ–¥–∏—Ç–µ –º—ã—à—å –Ω–∞ –ª—é–±–æ–π —ç–ª–µ–º–µ–Ω—Ç –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ</li>
                <li>–°–ª–µ–≤–∞ –ø–æ—è–≤–∏—Ç—Å—è <code>‚ãÆ‚ãÆ</code> (drag handle)</li>
                <li>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —ç–ª–µ–º–µ–Ω—Ç –Ω–∞ –Ω—É–∂–Ω–æ–µ –º–µ—Å—Ç–æ</li>
                <li>–°–∏–Ω—è—è –ª–∏–Ω–∏—è –ø–æ–∫–∞–∂–µ—Ç –≥–¥–µ —É–ø–∞–¥–µ—Ç —ç–ª–µ–º–µ–Ω—Ç</li>
                <li>–û—Ç–ø—É—Å—Ç–∏—Ç–µ –º—ã—à—å - —ç–ª–µ–º–µ–Ω—Ç –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—Å—è</li>
                </ol>
            </div>

        <div class="controls">
            <button onclick="addBlock('paragraph')">+ –ü–∞—Ä–∞–≥—Ä–∞—Ñ</button>
            <button onclick="addBlock('heading2')">+ –ó–∞–≥–æ–ª–æ–≤–æ–∫ H2</button>
            <button onclick="addBlock('list')">+ –°–ø–∏—Å–æ–∫</button>
            <button onclick="addBlock('blockquote')">+ –¶–∏—Ç–∞—Ç–∞</button>
            <button onclick="clearAll()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
            <button onclick="exportData()">üì§ –≠–∫—Å–ø–æ—Ä—Ç</button>
            </div>

        <div class="editor-wrapper">
            <div class="editor" id="editor" contenteditable="true">
                <div class="block" data-type="heading">üéØ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</div>
                <div class="block" data-type="paragraph">–≠—Ç–æ —Ç–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ drag & drop —Ñ—É–Ω–∫—Ü–∏–∏.</div>
                <div class="block" data-type="heading2">–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:</div>
                <div class="block" data-type="paragraph">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç—å —ç—Ç–æ—Ç –ø–∞—Ä–∞–≥—Ä–∞—Ñ –≤—ã—à–µ –∏–ª–∏ –Ω–∏–∂–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞!</div>
                <div class="block" data-type="list">‚Ä¢ –ü–µ—Ä–≤—ã–π –ø—É–Ω–∫—Ç</div>
                <div class="block" data-type="list">‚Ä¢ –í—Ç–æ—Ä–æ–π –ø—É–Ω–∫—Ç</div>
                <div class="block" data-type="blockquote">–≠—Ç–æ —Ü–∏—Ç–∞—Ç–∞ - –º–æ–∂–Ω–æ –µ—ë —Ç–æ–∂–µ –ø–µ—Ä–µ–º–µ—â–∞—Ç—å!</div>
                <div class="block" data-type="paragraph">–ü–æ—Å–ª–µ–¥–Ω–∏–π –ø–∞—Ä–∞–≥—Ä–∞—Ñ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.</div>
                </div>
            </div>

        <div class="status" id="status">
            <div class="status-item info">‚úÖ –°—Ç–∞—Ç—É—Å: –≥–æ—Ç–æ–≤–æ –∫ —Ä–∞–±–æ—Ç–µ</div>
                </div>
            </div>

    <script>
        const editor = document.getElementById('editor');
        const statusEl = document.getElementById('status');
        let draggedBlock = null;
        let draggedBlockOffset = 0;
        let lastOverBlock = null;
        let lastOverPosition = null;
        let lastDragoverTime = 0;
        const dragoverThrottle = 100; // 100ms

        // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const item = document.createElement('div');
            item.className = `status-item ${type}`;
            item.textContent = `[${timestamp}] ${message}`;
            statusEl.insertBefore(item, statusEl.firstChild);

            while (statusEl.children.length > 15) {
                statusEl.removeChild(statusEl.lastChild);
            }
        }

        // Drag & Drop —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
        editor.addEventListener('dragstart', (e) => {
            const block = e.target.closest('.block');
            if (!block) return;

            draggedBlock = block;
            draggedBlockOffset = e.clientY - block.getBoundingClientRect().top;

            block.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', block.innerHTML);

            log(`üéØ –ù–∞—á–∏–Ω–∞—é –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ: ${block.dataset.type}`, 'info');
            return true;
        }, true);

        editor.addEventListener('dragover', (e) => {
             if (!draggedBlock) return;

             e.preventDefault();
             e.dataTransfer.dropEffect = 'move';

             // Throttle dragover —Å–æ–±—ã—Ç–∏—è (–º–∞–∫—Å–∏–º—É–º 1 —Ä–∞–∑ –≤ 100ms)
             const now = Date.now();
             if (now - lastDragoverTime < dragoverThrottle) {
                 return false;
             }
             lastDragoverTime = now;

             const block = e.target.closest('.block');
             if (!block || block === draggedBlock) return;

             // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω—É–∂–Ω–æ –ª–∏ –≤—Å—Ç–∞–≤–∏—Ç—å —Å–≤–µ—Ä—Ö—É –∏–ª–∏ —Å–Ω–∏–∑—É —Å 40% threshold
             const rect = block.getBoundingClientRect();
             const elementHeight = rect.height;
             const offsetFromTop = e.clientY - rect.top;
             
             // –ï—Å–ª–∏ –Ω–∞—Ö–æ–¥–∏–º—Å—è –≤ –≤–µ—Ä—Ö–Ω–∏—Ö 40% —ç–ª–µ–º–µ–Ω—Ç–∞ - —ç—Ç–æ "top", –æ—Å—Ç–∞–ª—å–Ω–æ–µ "bottom"
             const isTop = offsetFromTop < elementHeight * 0.4;
             const position = isTop ? 'top' : 'bottom';

             // –ï—Å–ª–∏ —ç—Ç–æ –Ω–æ–≤—ã–π –±–ª–æ–∫ –∏–ª–∏ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å –ø–æ–∑–∏—Ü–∏—è
             if (block !== lastOverBlock || position !== lastOverPosition) {
                 // –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã–π –±–ª–æ–∫
                 if (lastOverBlock) {
                     lastOverBlock.classList.remove('drag-over-top', 'drag-over-bottom');
                 }

                 lastOverBlock = block;
                 lastOverPosition = position;

                 // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π –∫–ª–∞—Å—Å
                 if (isTop) {
                     block.classList.add('drag-over-top');
                 } else {
                     block.classList.add('drag-over-bottom');
                 }
             }

             return false;
         }, true);

        editor.addEventListener('dragleave', (e) => {
             const block = e.target.closest('.block');
             if (block === lastOverBlock) {
                 block.classList.remove('drag-over-top', 'drag-over-bottom');
                 lastOverBlock = null;
                 lastOverPosition = null;
             }
         }, true);

         editor.addEventListener('drop', (e) => {
             e.preventDefault();

             if (!draggedBlock) return;

             const targetBlock = e.target.closest('.block');
             if (!targetBlock || targetBlock === draggedBlock) {
                 draggedBlock.classList.remove('dragging');
                 draggedBlock = null;
                 lastOverBlock = null;
                 lastOverPosition = null;
                 return;
             }

             // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω—É–∂–Ω–æ –ª–∏ –≤—Å—Ç–∞–≤–∏—Ç—å —Å–≤–µ—Ä—Ö—É –∏–ª–∏ —Å–Ω–∏–∑—É
             const rect = targetBlock.getBoundingClientRect();
             const isTop = e.clientY < rect.top + rect.height / 2;

             if (isTop) {
                 targetBlock.parentNode.insertBefore(draggedBlock, targetBlock);
                    } else {
                 targetBlock.parentNode.insertBefore(draggedBlock, targetBlock.nextSibling);
             }

             log(`‚úÖ –ë–ª–æ–∫ —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ–º–µ—â–µ–Ω`, 'success');
             
             return false;
         }, true);

         editor.addEventListener('dragend', (e) => {
             document.querySelectorAll('.dragging, .drag-over-top, .drag-over-bottom').forEach(el => {
                 el.classList.remove('dragging', 'drag-over-top', 'drag-over-bottom');
             });
             draggedBlock = null;
             lastOverBlock = null;
             lastOverPosition = null;
             lastDragoverTime = 0;
         }, true);

        // –§—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        function addBlock(type) {
            const block = document.createElement('div');
            block.className = 'block';
            block.draggable = true;
            block.dataset.type = type;

            const content = {
                'paragraph': '–ù–æ–≤—ã–π –ø–∞—Ä–∞–≥—Ä–∞—Ñ...',
                'heading2': '–ù–æ–≤—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫',
                'list': '‚Ä¢ –ù–æ–≤—ã–π –ø—É–Ω–∫—Ç',
                'blockquote': '–ù–æ–≤–∞—è —Ü–∏—Ç–∞—Ç–∞...'
            };

            block.textContent = content[type] || '–ù–æ–≤—ã–π –±–ª–æ–∫';
            editor.appendChild(block);

            log(`‚úÖ –ë–ª–æ–∫ —Ç–∏–ø–∞ "${type}" –¥–æ–±–∞–≤–ª–µ–Ω`, 'success');
        }

        function clearAll() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã? –í–µ—Å—å –∫–æ–Ω—Ç–µ–Ω—Ç –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω!')) {
                editor.innerHTML = '<div class="block" data-type="paragraph">–†–µ–¥–∞–∫—Ç–æ—Ä –æ—á–∏—â–µ–Ω...</div>';
                log('üóëÔ∏è –ö–æ–Ω—Ç–µ–Ω—Ç –æ—á–∏—â–µ–Ω', 'success');
            }
        }

        function exportData() {
            const blocks = Array.from(document.querySelectorAll('.block')).map(block => ({
                type: block.dataset.type,
                content: block.textContent
            }));

            const json = JSON.stringify(blocks, null, 2);
            console.log('Exported data:', json);
            alert('–î–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12 ‚Üí Console)');
            log('üì§ –î–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã', 'success');
        }

        // –î–µ–ª–∞–µ–º –±–ª–æ–∫–∏ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–µ–º—ã–º–∏
        document.querySelectorAll('.block').forEach(block => {
            block.draggable = true;
        });

        log('‚úÖ –†–µ–¥–∞–∫—Ç–æ—Ä –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'success');
        log('–°–æ–∑–¥–∞–Ω–æ 8 —Ç–µ—Å—Ç–æ–≤—ã—Ö –±–ª–æ–∫–æ–≤', 'info');
    </script>
</body>
</html>







